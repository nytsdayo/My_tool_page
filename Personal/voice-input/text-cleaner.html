<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>テキストクリーナー - カタカナ・区切り除去</title>
    <link rel="stylesheet" href="text-cleaner.css">
</head>
<body>
    <div class="container">
        <h1>🧹 テキストクリーナー</h1>
        <p class="description">
            音声認識結果からカタカナのルビ、区切り文字（|）、カンマ、タイムスタンプを除去し、行末に句読点を追加します
        </p>

        <div class="example">
            <h4>📝 使用例:</h4>
            <p class="example-text input-example">入力: 今|イマから|カラえっと|エットあの|アノ卒論|ソツロンの|ノ</p>
            <p class="example-text output-example">出力: 今からえっとあの卒論の。</p>
        </div>

        <div class="input-section">
            <label for="input">入力テキスト:</label>
            <textarea id="input" placeholder="ここにテキストを貼り付けてください..."></textarea>
        </div>

        <div class="button-group">
            <button class="btn btn-primary" id="cleanBtn">変換する</button>
            <button class="btn btn-secondary" id="clearBtn">クリア</button>
        </div>

        <div class="output-section">
            <label for="output">変換結果:</label>
            <textarea id="output" readonly placeholder="変換結果がここに表示されます..."></textarea>
        </div>

        <div class="button-group">
            <button class="btn btn-copy" id="copyBtn">📋 結果をコピー</button>
        </div>

        <a href="index.html" class="nav-link">🎤 音声入力ページへ戻る</a>
        <a href="../index.html" class="nav-link">← Personal Toolsへ</a>
        <a href="../../index.html" class="nav-link">🏠 トップページへ</a>
    </div>

    <script>
        const inputTextarea = document.getElementById('input');
        const outputTextarea = document.getElementById('output');
        const cleanBtn = document.getElementById('cleanBtn');
        const clearBtn = document.getElementById('clearBtn');
        const copyBtn = document.getElementById('copyBtn');

        /**
         * テキストからカタカナ、「|」、「,」、タイムスタンプを除去し、各行末に句読点を追加する
         * @param {string} text - 入力テキスト
         * @returns {string} - クリーンなテキスト
         */
        function cleanText(text) {
            // 行ごとに処理
            const lines = text.split('\n');
            const cleanedLines = lines.map(line => {
                // タイムスタンプ行（HH:MM:SS形式）を除去
                if (/^\d{1,2}:\d{2}:\d{2}\s*$/.test(line.trim())) {
                    return '';
                }

                // |に続くカタカナ（長音符ー、小文字、繰り返し記号を含む）を除去
                let cleaned = line.replace(/\|[\u30A0-\u30FF]+/g, '');

                // ,に続くカタカナを除去し、残りのカンマも除去
                cleaned = cleaned.replace(/,[\u30A0-\u30FF]*/g, '');

                // 行末に句読点を追加（空行でなく、既に句読点がない場合）
                const trimmed = cleaned.trim();
                if (trimmed && !/[。、！？!?]$/.test(trimmed)) {
                    cleaned = trimmed + '。';
                }

                return cleaned;
            });

            // 空行を除去して結合
            return cleanedLines.filter(line => line.trim() !== '').join('\n');
        }

        // 変換ボタン
        cleanBtn.addEventListener('click', () => {
            const inputText = inputTextarea.value;
            const cleanedText = cleanText(inputText);
            outputTextarea.value = cleanedText;
        });

        // 入力時にリアルタイム変換
        inputTextarea.addEventListener('input', () => {
            const inputText = inputTextarea.value;
            const cleanedText = cleanText(inputText);
            outputTextarea.value = cleanedText;
        });

        // クリアボタン
        clearBtn.addEventListener('click', () => {
            inputTextarea.value = '';
            outputTextarea.value = '';
            inputTextarea.focus();
        });

        // コピーボタン
        copyBtn.addEventListener('click', async () => {
            const textToCopy = outputTextarea.value;
            if (!textToCopy) {
                return;
            }

            try {
                await navigator.clipboard.writeText(textToCopy);
                copyBtn.textContent = '✅ コピーしました!';
                copyBtn.classList.add('copied');
                
                setTimeout(() => {
                    copyBtn.textContent = '📋 結果をコピー';
                    copyBtn.classList.remove('copied');
                }, 2000);
            } catch (err) {
                // フォールバック: 古いブラウザ対応
                outputTextarea.select();
                document.execCommand('copy');
                copyBtn.textContent = '✅ コピーしました!';
                copyBtn.classList.add('copied');
                
                setTimeout(() => {
                    copyBtn.textContent = '📋 結果をコピー';
                    copyBtn.classList.remove('copied');
                }, 2000);
            }
        });
    </script>
</body>
</html>
